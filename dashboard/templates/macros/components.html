{# ==============================================
   Shared UI Component Macros
   Used across ABX Indications, Surgical Prophylaxis, and HAI Detection
   ============================================== #}

{# Info Grid Macro
   Renders a responsive grid of label/value pairs

   Usage:
   {% from "macros/components.html" import info_grid %}
   {{ info_grid([
       {'label': 'Patient MRN', 'value': patient.mrn, 'class': 'patient-mrn'},
       {'label': 'Name', 'value': patient.name},
       {'label': 'Location', 'value': patient.location or '-'}
   ]) }}
#}
{% macro info_grid(items) %}
<div class="info-grid">
    {% for item in items %}
    <div class="info-item">
        <span class="info-label">{{ item.label }}</span>
        <span class="info-value {{ item.class or '' }}">{{ item.value if item.value is not none and item.value != '' else '-' }}</span>
    </div>
    {% endfor %}
</div>
{% endmacro %}


{# Evidence Sources Macro (Full Attribution Format)
   Renders LLM evidence with note type badges, dates, authors, and quotes

   Expected source structure (ABX Indications format):
   {
       note_type: str,      # PROGRESS_NOTE, ID_CONSULT, etc.
       note_date: str|None,
       author: str|None,
       quotes: list[str],
       relevance: str|None
   }

   Usage:
   {% from "macros/components.html" import evidence_sources_full %}
   {{ evidence_sources_full(extraction.evidence_sources) }}
#}
{% macro evidence_sources_full(sources, title="Supporting Evidence with Sources") %}
{% if sources %}
<div class="extraction-section evidence-sources">
    <strong>{{ title }}:</strong>
    {% for source in sources %}
    <div class="evidence-item">
        <div class="evidence-header">
            <span class="badge badge-note-type">{{ source.note_type }}</span>
            {% if source.note_date %}<span class="evidence-date">{{ source.note_date }}</span>{% endif %}
            {% if source.author %}<span class="evidence-author">by {{ source.author }}</span>{% endif %}
        </div>
        {% if source.relevance %}<div class="evidence-relevance">{{ source.relevance }}</div>{% endif %}
        {% if source.quotes %}
        <ul class="evidence-quotes">
            {% for quote in source.quotes %}<li class="quote">{{ quote }}</li>{% endfor %}
        </ul>
        {% endif %}
    </div>
    {% endfor %}
</div>
{% endif %}
{% endmacro %}


{# Evidence Sources Macro (Simple Format)
   Renders LLM evidence with source string and text

   Expected source structure (HAI Detection format):
   {
       text: str,           # The evidence quote/text
       source: str,         # Free-form string like "Progress Note from 01/15"
       relevance: str|None
   }

   Usage:
   {% from "macros/components.html" import evidence_sources_simple %}
   {{ evidence_sources_simple(classification.supporting_evidence, variant='supporting') }}
   {{ evidence_sources_simple(classification.contradicting_evidence, variant='contradicting') }}
#}
{% macro evidence_sources_simple(sources, title="Evidence", variant='supporting') %}
{% if sources %}
<div class="extraction-section evidence-sources evidence-{{ variant }}">
    <strong>{{ title }}:</strong>
    {% for item in sources %}
    <div class="evidence-item">
        <div class="evidence-header">
            <span class="badge badge-evidence-source">{{ item.source }}</span>
        </div>
        <div class="evidence-text">{{ item.text }}</div>
        {% if item.relevance %}<div class="evidence-relevance">{{ item.relevance }}</div>{% endif %}
    </div>
    {% endfor %}
</div>
{% endif %}
{% endmacro %}


{# Extraction Metadata Macro
   Renders confidence, model, token counts in a consistent footer format

   Usage:
   {% from "macros/components.html" import extraction_meta %}
   {{ extraction_meta(
       confidence=extraction.confidence,
       model=extraction.model_used,
       notes_filtered=extraction.notes_filtered_count,
       notes_total=extraction.notes_total_count,
       tokens=extraction.tokens_used
   ) }}
#}
{% macro extraction_meta(confidence, model, notes_filtered=none, notes_total=none, tokens=none, prompt_version=none) %}
<div class="extraction-meta">
    {% if confidence is not none %}
    <span class="confidence">Confidence: {{ "%.0f"|format((confidence or 0) * 100) }}%</span>
    {% endif %}
    {% if model %}
    <span class="model">Model: {{ model }}</span>
    {% endif %}
    {% if prompt_version %}
    <span class="prompt">Prompt: {{ prompt_version }}</span>
    {% endif %}
    {% if notes_filtered is not none and notes_total is not none %}
    <span class="notes-count">Notes: {{ notes_filtered }}/{{ notes_total }}</span>
    {% endif %}
    {% if tokens %}
    <span class="tokens">Tokens: {{ tokens }}</span>
    {% endif %}
</div>
{% endmacro %}


{# Classification Badge Macro
   Renders a badge with appropriate styling based on classification value

   Usage:
   {% from "macros/components.html" import classification_badge %}
   {{ classification_badge('A', size='lg') }}
   {{ classification_badge(candidate.final_classification) }}
#}
{% macro classification_badge(classification, size='') %}
{% set labels = {
    'A': 'Appropriate',
    'S': 'Sometimes',
    'N': 'Never Appropriate',
    'P': 'Prophylaxis',
    'FN': 'Febrile Neutropenia',
    'U': 'Unknown'
} %}
<span class="badge {{ 'badge-lg' if size == 'lg' else '' }} badge-classification-{{ classification }}">
    {{ labels.get(classification, classification or 'Unknown') }}
</span>
{% endmacro %}


{# Status Badge Macro
   Renders a badge with appropriate styling based on status value

   Usage:
   {% from "macros/components.html" import status_badge %}
   {{ status_badge('confirmed') }}
   {{ status_badge(candidate.status.value) }}
#}
{% macro status_badge(status, size='') %}
{% set badge_class = {
    'confirmed': 'success',
    'rejected': 'danger',
    'pending': 'warning',
    'pending_review': 'info',
    'classified': 'info',
    'excluded': 'secondary'
}.get(status, 'secondary') %}
<span class="badge {{ 'badge-lg' if size == 'lg' else '' }} badge-{{ badge_class }}">
    {{ status | replace('_', ' ') | title }}
</span>
{% endmacro %}


{# ==============================================
   HAI Type-Specific Detail Fields Macro
   Centralizes NHSN-required fields for each HAI type
   ============================================== #}

{# HAI Type Details Macro
   Renders type-specific information sections based on HAI type.
   Centralizes field definitions for easier maintenance when NHSN requirements change.

   Usage:
   {% from "macros/components.html" import hai_type_details %}
   {{ hai_type_details(
       hai_type=candidate.hai_type.value,
       candidate=candidate,
       ssi_data=ssi_data,
       cdi_data=cdi_data,
       cauti_data=cauti_data,
       vae_data=vae_data
   ) }}
#}
{% macro hai_type_details(hai_type, candidate, ssi_data=none, cdi_data=none, cauti_data=none, vae_data=none) %}

{% if hai_type == 'clabsi' %}
    {{ _clabsi_details(candidate) }}

{% elif hai_type == 'ssi' %}
    {{ _ssi_details(ssi_data) }}

{% elif hai_type == 'cdi' %}
    {{ _cdi_details(cdi_data) }}

{% elif hai_type == 'cauti' %}
    {{ _cauti_details(cauti_data) }}

{% elif hai_type == 'vae' %}
    {{ _vae_details(vae_data) }}

{% else %}
    <h3>Device/Procedure Information</h3>
    <p class="text-muted">No device or procedure information available for this HAI type.</p>
{% endif %}

{% endmacro %}


{# --- CLABSI Details --- #}
{% macro _clabsi_details(candidate) %}
<h3>CLABSI Details</h3>
{{ info_grid([
    {'label': 'Device Days', 'value': candidate.device_days_at_culture if candidate.device_days_at_culture is not none else '?'},
    {'label': 'Line Site', 'value': candidate.device_info.site if candidate.device_info and candidate.device_info.site else none},
    {'label': 'Line Type', 'value': (candidate.device_info.device_type | replace('_', ' ') | title) if candidate.device_info and candidate.device_info.device_type else none},
    {'label': 'Inserted', 'value': candidate.device_info.insertion_date.strftime('%m/%d/%Y') if candidate.device_info and candidate.device_info.insertion_date else '?'},
    {'label': 'Removed', 'value': candidate.device_info.removal_date.strftime('%m/%d/%Y') if candidate.device_info and candidate.device_info.removal_date else none}
]) }}
{% endmacro %}


{# --- SSI Details --- #}
{% macro _ssi_details(ssi_data) %}
{% if ssi_data %}
<h3>SSI / Procedure Information</h3>
{{ info_grid([
    {'label': 'Procedure', 'value': ssi_data.procedure_name},
    {'label': 'NHSN Category', 'value': ssi_data.nhsn_category},
    {'label': 'Procedure Date', 'value': ssi_data.procedure_date.strftime('%Y-%m-%d') if ssi_data.procedure_date else 'Unknown'},
    {'label': 'Days Post-Op', 'value': ssi_data.days_post_op},
    {'label': 'Wound Class', 'value': _wound_class_display(ssi_data.wound_class)},
    {'label': 'Implant', 'value': _implant_display(ssi_data.implant_used, ssi_data.implant_type)},
    {'label': 'Surveillance Window', 'value': (ssi_data.surveillance_days|string ~ ' days') if ssi_data.surveillance_days else none},
    {'label': 'SSI Type', 'value': (ssi_data.ssi_type | replace('_', ' ') | title) if ssi_data.ssi_type else none}
]) }}
{% else %}
<h3>SSI / Procedure Information</h3>
<p class="text-muted">No SSI-specific data available.</p>
{% endif %}
{% endmacro %}

{% macro _wound_class_display(wound_class) %}
{% if wound_class %}
{% set wound_labels = {'1': 'Clean', '2': 'Clean-Contaminated', '3': 'Contaminated', '4': 'Dirty-Infected'} %}
{{ wound_class|string ~ ' - ' ~ wound_labels.get(wound_class|string, 'Unknown') }}
{% endif %}
{% endmacro %}

{% macro _implant_display(implant_used, implant_type) %}
{% if implant_used %}Yes{% if implant_type %} ({{ implant_type }}){% endif %}{% else %}No{% endif %}
{% endmacro %}


{# --- CDI Details --- #}
{% macro _cdi_details(cdi_data) %}
{% if cdi_data %}
<h3>CDI Details</h3>
{{ info_grid([
    {'label': 'Test Type', 'value': cdi_data.test_type},
    {'label': 'Test Date', 'value': cdi_data.test_date.strftime('%m/%d/%Y %H:%M') if cdi_data.test_date else none},
    {'label': 'Admission Date', 'value': cdi_data.admission_date.strftime('%m/%d/%Y') if cdi_data.admission_date else none},
    {'label': 'Specimen Day', 'value': cdi_data.specimen_day},
    {'label': 'Onset Type', 'value': cdi_data.onset_type_display},
    {'label': 'Classification', 'value': (cdi_data.classification | replace('_', ' ') | title) if cdi_data.classification else none}
]) }}

<h3>Recurrence Information</h3>
{{ info_grid([
    {'label': 'Is Recurrent', 'value': 'Yes' if cdi_data.is_recurrent else 'No'},
    {'label': 'Is Duplicate', 'value': 'Yes (not reportable)' if cdi_data.is_duplicate else 'No'},
    {'label': 'Days Since Last CDI', 'value': cdi_data.days_since_last_cdi},
    {'label': 'Prior Episodes', 'value': cdi_data.prior_episode_count}
]) }}

{% if cdi_data.onset_type == 'co_hcfa' %}
<h3>CO-HCFA Details</h3>
{{ info_grid([
    {'label': 'Recent Discharge', 'value': cdi_data.recent_discharge_date.strftime('%m/%d/%Y') if cdi_data.recent_discharge_date else none},
    {'label': 'Discharge Facility', 'value': cdi_data.recent_discharge_facility}
]) }}
{% endif %}

{% else %}
<h3>CDI Details</h3>
<p class="text-muted">No CDI-specific data available.</p>
{% endif %}
{% endmacro %}


{# --- CAUTI Details --- #}
{% macro _cauti_details(cauti_data) %}
{% if cauti_data %}
<h3>CAUTI Details</h3>
{{ info_grid([
    {'label': 'Catheter Days', 'value': cauti_data.catheter_days},
    {'label': 'Patient Age', 'value': (cauti_data.patient_age|string ~ ' years') if cauti_data.patient_age else none},
    {'label': 'Culture CFU/mL', 'value': cauti_data.culture_cfu_ml},
    {'label': 'Organism', 'value': cauti_data.culture_organism},
    {'label': 'Organism Count', 'value': cauti_data.culture_organism_count}
]) }}

{% if cauti_data.catheter_type or cauti_data.catheter_insertion_date %}
<h3>Catheter Information</h3>
{{ info_grid([
    {'label': 'Catheter Type', 'value': (cauti_data.catheter_type | replace('_', ' ') | title) if cauti_data.catheter_type else none},
    {'label': 'Site', 'value': cauti_data.catheter_site},
    {'label': 'Inserted', 'value': cauti_data.catheter_insertion_date.strftime('%m/%d/%Y') if cauti_data.catheter_insertion_date else none},
    {'label': 'Removed', 'value': cauti_data.catheter_removal_date.strftime('%m/%d/%Y') if cauti_data.catheter_removal_date else none}
]) }}
{% endif %}

{% else %}
<h3>CAUTI Details</h3>
<p class="text-muted">No CAUTI-specific data available.</p>
{% endif %}
{% endmacro %}


{# --- VAE Details --- #}
{% macro _vae_details(vae_data) %}
{% if vae_data %}
<h3>VAE Details</h3>
{{ info_grid([
    {'label': 'VAC Onset Date', 'value': vae_data.vac_onset_date.strftime('%m/%d/%Y') if vae_data.vac_onset_date else none},
    {'label': 'Vent Day at Onset', 'value': vae_data.ventilator_day_at_onset},
    {'label': 'FiO2 Criterion Met', 'value': 'Yes' if vae_data.met_fio2_criterion else 'No'},
    {'label': 'PEEP Criterion Met', 'value': 'Yes' if vae_data.met_peep_criterion else 'No'}
]) }}

<h3>Baseline Period</h3>
{{ info_grid([
    {'label': 'Baseline Start', 'value': vae_data.baseline_start_date.strftime('%m/%d/%Y') if vae_data.baseline_start_date else none},
    {'label': 'Baseline End', 'value': vae_data.baseline_end_date.strftime('%m/%d/%Y') if vae_data.baseline_end_date else none},
    {'label': 'Baseline Min FiO2', 'value': (vae_data.baseline_min_fio2|string ~ '%') if vae_data.baseline_min_fio2 else none},
    {'label': 'Baseline Min PEEP', 'value': (vae_data.baseline_min_peep|string ~ ' cmH2O') if vae_data.baseline_min_peep else none}
]) }}

<h3>Worsening Period</h3>
{{ info_grid([
    {'label': 'Worsening Start', 'value': vae_data.worsening_start_date.strftime('%m/%d/%Y') if vae_data.worsening_start_date else none},
    {'label': 'FiO2 Increase', 'value': ('+' ~ vae_data.fio2_increase|round(1)|string ~ '%') if vae_data.fio2_increase else none},
    {'label': 'PEEP Increase', 'value': ('+' ~ vae_data.peep_increase|round(1)|string ~ ' cmH2O') if vae_data.peep_increase else none}
]) }}

{% if vae_data.intubation_date %}
<h3>Ventilation Episode</h3>
{{ info_grid([
    {'label': 'Intubation Date', 'value': vae_data.intubation_date.strftime('%m/%d/%Y %H:%M') if vae_data.intubation_date else none},
    {'label': 'Extubation Date', 'value': vae_data.extubation_date.strftime('%m/%d/%Y %H:%M') if vae_data.extubation_date else none},
    {'label': 'Ventilator Mode', 'value': vae_data.ventilator_mode},
    {'label': 'Location', 'value': vae_data.location}
]) }}
{% endif %}

{% else %}
<h3>VAE Details</h3>
<p class="text-muted">No VAE-specific data available.</p>
{% endif %}
{% endmacro %}


{# ==============================================
   Dashboard & Report Component Macros
   Used across all dashboard and report pages
   ============================================== #}

{# Stat Card Macro
   Renders a single statistics card with value, label, and optional sublabel

   Variants: primary, success, warning, danger, info, critical

   Usage:
   {% from "macros/components.html" import stat_card %}
   {{ stat_card(value=42, label="Pending Review", sublabel="Awaiting decision", variant="primary") }}
#}
{% macro stat_card(value, label, sublabel=none, variant=none, value_class=none) %}
<div class="stat-card {{ 'stat-' ~ variant if variant else '' }}">
    <div class="stat-value {{ value_class or '' }}">{{ value }}</div>
    <div class="stat-label">{{ label }}</div>
    {% if sublabel %}<div class="stat-sublabel">{{ sublabel }}</div>{% endif %}
</div>
{% endmacro %}


{# Stats Grid Macro
   Renders a grid of stat cards from a list of card definitions

   Usage:
   {% from "macros/components.html" import stats_grid %}
   {{ stats_grid([
       {'value': 42, 'label': 'Pending', 'variant': 'primary'},
       {'value': 15, 'label': 'Confirmed', 'sublabel': 'This month', 'variant': 'success'},
       {'value': '85%', 'label': 'Rate', 'variant': 'info'}
   ]) }}
#}
{% macro stats_grid(cards) %}
<div class="stats-grid">
    {% for card in cards %}
    {{ stat_card(
        value=card.value,
        label=card.label,
        sublabel=card.sublabel,
        variant=card.variant,
        value_class=card.value_class
    ) }}
    {% endfor %}
</div>
{% endmacro %}


{# Empty State Macro
   Renders an empty state message with optional link

   Usage:
   {% from "macros/components.html" import empty_state %}
   {{ empty_state("No data available.") }}
   {{ empty_state("No cases found.", link_url=url_for('hai.history'), link_text="View history") }}
#}
{% macro empty_state(message, link_url=none, link_text=none) %}
<p class="empty-state">
    {{ message }}
    {% if link_url and link_text %}
    <a href="{{ link_url }}">{{ link_text }}</a>
    {% endif %}
</p>
{% endmacro %}


{# HAI Type Badge Macro
   Renders a color-coded badge for HAI types

   Colors: CLABSI=red, CAUTI=amber, SSI=purple, VAE=blue, CDI=teal

   Usage:
   {% from "macros/components.html" import hai_type_badge %}
   {{ hai_type_badge('clabsi') }}
   {{ hai_type_badge(candidate.hai_type.value) }}
#}
{% macro hai_type_badge(hai_type, size=none) %}
<span class="badge badge-hai-{{ hai_type }} {{ 'badge-' ~ size if size else '' }}">
    {{ hai_type | upper }}
</span>
{% endmacro %}


{# Decision Badge Macro
   Renders a badge for LLM or reviewer decisions

   Supports: hai_confirmed, not_hai, pending_review, confirmed, rejected, needs_more_info

   Usage:
   {% from "macros/components.html" import decision_badge %}
   {{ decision_badge('hai_confirmed') }}
   {{ decision_badge(classification.decision.value, prefix="LLM:") }}
#}
{% macro decision_badge(decision, size=none, prefix=none) %}
{% set badge_config = {
    'hai_confirmed': {'class': 'danger', 'text': 'HAI'},
    'not_hai': {'class': 'success', 'text': 'Not HAI'},
    'pending_review': {'class': 'warning', 'text': 'Uncertain'},
    'confirmed': {'class': 'success', 'text': 'Confirmed'},
    'rejected': {'class': 'secondary', 'text': 'Rejected'},
    'needs_more_info': {'class': 'warning', 'text': 'Needs Info'}
} %}
{% set config = badge_config.get(decision, {'class': 'secondary', 'text': decision | replace('_', ' ') | title}) %}
{% if prefix %}<span class="badge-prefix">{{ prefix }}</span>{% endif %}
<span class="badge badge-{{ config.class }} {{ 'badge-' ~ size if size else '' }}">
    {{ config.text }}
</span>
{% endmacro %}


{# Priority Badge Macro
   Renders a priority score badge with automatic color coding

   Colors: >10=high (red), >5=medium (amber), <=5=low (green)

   Usage:
   {% from "macros/components.html" import priority_badge %}
   {{ priority_badge(12.5) }}
   {{ priority_badge(target.priority_score) }}
#}
{% macro priority_badge(score) %}
{% if score is not none %}
{% set level = 'high' if score > 10 else 'medium' if score > 5 else 'low' %}
<span class="priority-badge priority-{{ level }}">
    {{ score | round(1) }}
</span>
{% else %}
<span class="priority-badge priority-none">--</span>
{% endif %}
{% endmacro %}


{# Metric Row Macro
   Renders a label/value pair for metrics display

   Usage:
   {% from "macros/components.html" import metric_row %}
   {{ metric_row("Acceptance Rate", "85%", value_class="text-success") }}
   {{ metric_row("Override Rate", stats.override_rate ~ "%") }}
#}
{% macro metric_row(label, value, value_class=none) %}
<div class="metric-row">
    <span class="metric-label">{{ label }}</span>
    <span class="metric-value {{ value_class or '' }}">{{ value if value is not none else '--' }}</span>
</div>
{% endmacro %}


{# Metric Rows Container Macro
   Renders multiple metric rows from a list

   Usage:
   {% from "macros/components.html" import metric_rows %}
   {{ metric_rows([
       {'label': 'Total Reviews', 'value': 150},
       {'label': 'Acceptance Rate', 'value': '85%', 'value_class': 'text-success'},
       {'label': 'Override Rate', 'value': '15%', 'value_class': 'text-warning'}
   ]) }}
#}
{% macro metric_rows(rows) %}
<div class="quality-metrics">
    {% for row in rows %}
    {{ metric_row(row.label, row.value, row.value_class) }}
    {% endfor %}
</div>
{% endmacro %}


{# Filter Select Macro
   Renders a dropdown select for filtering with optional auto-submit

   Usage:
   {% from "macros/components.html" import filter_select %}
   {{ filter_select(
       name="type",
       options=[('', 'All Types'), ('clabsi', 'CLABSI'), ('cauti', 'CAUTI')],
       current=current_type,
       label="HAI Type"
   ) }}
#}
{% macro filter_select(name, options, current=none, label=none, auto_submit=true) %}
<label class="filter-label">
    {% if label %}{{ label }}:{% endif %}
    <select name="{{ name }}" {% if auto_submit %}onchange="this.form.submit()"{% endif %}>
        {% for value, display in options %}
        <option value="{{ value }}" {% if current == value or (current is none and value == '') %}selected{% endif %}>
            {{ display }}
        </option>
        {% endfor %}
    </select>
</label>
{% endmacro %}


{# Filter Form Macro
   Renders a complete filter form with multiple selects

   Usage:
   {% from "macros/components.html" import filter_form %}
   {{ filter_form([
       {'name': 'type', 'label': 'HAI Type', 'options': hai_types, 'current': current_type},
       {'name': 'days', 'label': 'Period', 'options': day_options, 'current': current_days}
   ]) }}
#}
{% macro filter_form(filters) %}
<div class="filters">
    <form method="get" class="filter-form">
        {% for f in filters %}
        {{ filter_select(
            name=f.name,
            options=f.options,
            current=f.current,
            label=f.label,
            auto_submit=f.auto_submit if f.auto_submit is defined else true
        ) }}
        {% endfor %}
    </form>
</div>
{% endmacro %}


{# Data Table Macro
   Renders a data table with headers and rows

   Usage:
   {% from "macros/components.html" import data_table %}
   {{ data_table(
       headers=['Date', 'Patient', 'Type', 'Actions'],
       rows=[
           ['2024-01-15', 'Smith, John', 'CLABSI', '<a href="...">View</a>'],
           ['2024-01-14', 'Doe, Jane', 'CAUTI', '<a href="...">View</a>']
       ],
       empty_message="No records found."
   ) }}
#}
{% macro data_table(headers, rows, empty_message="No data available.", table_class="", row_classes=none) %}
{% if rows and rows | length > 0 %}
<table class="table {{ table_class }}">
    <thead>
        <tr>
            {% for header in headers %}
            <th>{{ header }}</th>
            {% endfor %}
        </tr>
    </thead>
    <tbody>
        {% for row in rows %}
        <tr class="{{ row_classes[loop.index0] if row_classes and loop.index0 < row_classes|length else '' }}">
            {% for cell in row %}
            <td>{{ cell | safe }}</td>
            {% endfor %}
        </tr>
        {% endfor %}
    </tbody>
</table>
{% else %}
{{ empty_state(empty_message) }}
{% endif %}
{% endmacro %}


{# Bar Chart Macro
   Renders a simple horizontal bar chart

   Supports flexible key names:
   - Standard: label/value
   - Alternative: date/count (for report_data.by_day format)

   Usage:
   {% from "macros/components.html" import bar_chart %}
   {{ bar_chart(
       items=[
           {'label': '2024-01-15', 'value': 5},
           {'label': '2024-01-14', 'value': 3},
           {'label': '2024-01-13', 'value': 8}
       ],
       bar_class="bar-hai"
   ) }}
#}
{% macro bar_chart(items, bar_class="bar-primary", show_values=true) %}
{% if items and items | length > 0 %}
<div class="chart-container">
    <div class="bar-chart">
        {% set max_val = namespace(v=1) %}
        {% for item in items %}
            {% set val = item.value if item.value is defined else item.count %}
            {% if val > max_val.v %}{% set max_val.v = val %}{% endif %}
        {% endfor %}
        {% for item in items %}
        {% set item_label = item.label if item.label is defined else item.date %}
        {% set item_value = item.value if item.value is defined else item.count %}
        <div class="bar-row">
            <span class="bar-label">{{ item_label }}</span>
            <div class="bar-wrapper">
                <div class="bar {{ bar_class }}" style="width: {{ (item_value / max_val.v * 100) | int }}%;">
                    {% if show_values %}<span class="bar-value">{{ item_value }}</span>{% endif %}
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
</div>
{% else %}
{{ empty_state("No chart data available.") }}
{% endif %}
{% endmacro %}


{# Quick Links Macro
   Renders a row of action buttons/links

   Supports both 'text' and 'label' keys for button text

   Usage:
   {% from "macros/components.html" import quick_links %}
   {{ quick_links([
       {'url': url_for('hai.history'), 'label': 'History', 'class': 'btn-secondary'},
       {'url': url_for('hai.reports'), 'label': 'Reports', 'class': 'btn-success'},
       {'url': url_for('hai.help'), 'label': 'Help', 'class': 'btn-info'}
   ]) }}
#}
{% macro quick_links(links, vertical=false) %}
<div class="quick-links {{ 'quick-links-vertical' if vertical else '' }}">
    {% for link in links %}
    <a href="{{ link.url }}" class="btn {{ link.class or 'btn-secondary' }} {{ 'btn-block' if vertical else '' }}">
        {{ link.label if link.label is defined else link.text }}
    </a>
    {% endfor %}
</div>
{% endmacro %}


{# Page Header Macro
   Renders a consistent page header with title and optional actions

   Usage:
   {% from "macros/components.html" import page_header %}
   {{ page_header(
       title="HAI Detection",
       subtitle="Healthcare-Associated Infection Candidate Detection",
       actions=[{'url': url_for('main.index'), 'text': 'Back', 'class': 'btn-secondary'}]
   ) }}
#}
{% macro page_header(title, subtitle=none, actions=none) %}
<div class="page-header">
    <div class="page-header-text">
        <h1>{{ title }}</h1>
        {% if subtitle %}<p class="subtitle">{{ subtitle }}</p>{% endif %}
    </div>
    {% if actions %}
    <div class="header-actions">
        {% for action in actions %}
        <a href="{{ action.url }}" class="btn {{ action.class or 'btn-secondary' }}">{{ action.text }}</a>
        {% endfor %}
    </div>
    {% endif %}
</div>
{% endmacro %}


{# Alert Box Macro
   Renders an alert/notification box

   Variants: success, warning, danger, info

   Usage:
   {% from "macros/components.html" import alert_box %}
   {{ alert_box("Operation completed successfully!", variant="success") }}
   {{ alert_box("Unable to load data.", variant="warning", details=error_message) }}
#}
{% macro alert_box(message, variant="info", details=none, dismissible=false) %}
<div class="alert alert-{{ variant }}">
    <strong>{{ {'success': 'Success:', 'warning': 'Note:', 'danger': 'Error:', 'info': 'Info:'}.get(variant, '') }}</strong>
    {{ message }}
    {% if details %}
    <br><small>{{ details }}</small>
    {% endif %}
</div>
{% endmacro %}


{# Dashboard Card Macro
   Renders a card container for dashboard sections

   Usage:
   {% from "macros/components.html" import dashboard_card %}
   {% call dashboard_card("Activity by Module") %}
       <table>...</table>
   {% endcall %}
#}
{% macro dashboard_card(title, subtitle=none) %}
<div class="dashboard-card">
    <h3>{{ title }}</h3>
    {% if subtitle %}<p class="card-subtitle">{{ subtitle }}</p>{% endif %}
    {{ caller() }}
</div>
{% endmacro %}


{# Report Card Macro
   Renders a card container for report sections (alias for dashboard_card)
#}
{% macro report_card(title, subtitle=none) %}
<div class="report-card">
    <h3>{{ title }}</h3>
    {% if subtitle %}<p class="card-subtitle">{{ subtitle }}</p>{% endif %}
    {{ caller() }}
</div>
{% endmacro %}
